package com.weather.forcast.service.impl;

import java.time.LocalDate;
import java.util.*;
import java.util.stream.Collectors;

import org.springframework.stereotype.Service;
import org.springframework.web.multipart.MultipartFile;

import com.weather.forcast.controller.MonthlyTemperatureDTO;
import com.weather.forcast.dto.WeatherResponseDTO;
import com.weather.forcast.entity.WeatherData;
import com.weather.forcast.repository.WeatherRepository;
import com.weather.forcast.service.WeatherService;
import com.weather.forcast.util.CsvUtil;

import lombok.RequiredArgsConstructor;

@Service
@RequiredArgsConstructor
public class WeatherServiceImpl implements WeatherService{
	private final WeatherRepository weatherRepository;
	@Override
	public void uploadCsv(MultipartFile file) {
		try {
			List<WeatherData> data=CsvUtil.parse(file.getInputStream());
			weatherRepository.saveAll(data);
		} catch (Exception e) {
			throw new RuntimeException("CSV upload failed");
		}
	}
	@Override
	public List<WeatherResponseDTO> getWeatherByDate(LocalDate date){
		return weatherRepository.findByDate(date)
				.stream()
				.map(data->WeatherResponseDTO.builder()
						.weatherCondition(data.getWeatherCondition())
						.temperature(data.getTemperature())
						.humidity(data.getHumidity())
						.pressure(data.getPressure())
						.build())
				.collect(Collectors.toList());
	}
	@Override
	public List<MonthlyTemperatureDTO> 
	
}
